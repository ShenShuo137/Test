# 简化版工作流（保留核心功能）
name: 智能代码审查

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  # Job 1: AI审查（使用你的GPT API key）
  pr_agent:
    runs-on: ubuntu-latest
    steps:
      - name: PR Agent action step
        id: pragent
      - uses: Codium-ai/pr-agent@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_KEY: ${{ secrets.GPT_API_KEY }}  # 你的第三方key
          OPENAI.API_BASE: "https://api.chatanywhere.tech/v1"  # 第三方API地址
          config.model: "gpt-4o"  # 或gpt-4
          config.language: "zh"
          github_action_config.auto_review: "true"
  
  # Job 2: 安全扫描
  codeql:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: github/codeql-action/init@v3
        with:
          languages: ['python']
          queries: +security-and-quality
      - uses: github/codeql-action/analyze@v3